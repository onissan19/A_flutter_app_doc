# Project Documentation: IoT Server and Mobile Application

## Introduction

This project involves setting up a server architecture for managing IoT (Internet of Things) devices and mobile applications connected in real-time via WebSocket. It also includes an HTTP server to handle the creation and authentication requests of IoT devices and mobile applications. The graphical interface provides a simple and seamless way to manage devices and HTTP logs.

---

## Server Architecture

### Main Components

1. **GlobalManager**  
   A centralized manager that coordinates access to server resources and services. It supervises the connections of IoT devices, mobile applications, and HTTP log registration.

2. **ThingsManager**  
   Manages IoT devices connected to the server. It provides real-time streaming of connected devices and allows managing the registration and disconnection of devices.

3. **AppMobileManager**  
   Manages the connected mobile applications in the same way as the `ThingsManager`. It supervises the connections and interactions of mobile applications.

4. **HttpLoggingManager**  
   Records the HTTP logs generated by received requests, allowing for detailed tracking of events on the server.

5. **DatabaseHelper**  
   Manages interactions with the database, allowing for the storage and retrieval of registered IoT devices and mobile applications.

6. **SocketServerManager**  
   Manages WebSocket connections between the server and clients (IoT devices and mobile applications). It maintains real-time communication with clients.

---

## HTTP Server

The HTTP server is made up of two main parts:

1. **Mobile App Server**  
   This server handles requests related to mobile applications, such as registration and authentication of mobile applications.

2. **Things App Server**  
   This server handles requests related to IoT devices, such as registration and authentication of IoT devices.

### HTTP Routes

#### General Routes

- **`GET /api/v1/hello`**  
  Verifies if the server is running properly. Returns a "Hello, World!" message.

#### Routes for Mobile Applications

- **`POST /api/v1/register`**  
  Registers a new mobile application. Expects a JSON body with the following fields:
  ```json
  {
    "id": "string",
    "name": "string"
  }
Returns a success message or an error if the application is already registered.

POST /api/v1/authenticate
Authenticates a mobile application. Expects a JSON body with the following fields:

json
Copier
Modifier
{
  "id": "string",
  "appKey": "string"
}
Returns a success message or an error.

Routes for IoT Devices
POST /api/v1/register
Registers a new IoT device. Expects a JSON body with the following fields:

json
Copier
Modifier
{
  "id": "string",
  "type": "string"
}
Returns a success message or an error if the device is already registered.

POST /api/v1/authenticate
Authenticates an IoT device. Expects a JSON body with the following fields:

json
Copier
Modifier
{
  "id": "string",
  "apiKey": "string"
}
Returns a success message or an error.

Graphical Interface
The user interface allows real-time management of IoT devices, mobile applications, and filtering of HTTP logs. It is structured into several interactive sections:

Main Page (HomePage)
The main page contains a tab bar with three tabs:

"Things" Tab
Displays the list of connected and disconnected IoT devices, with actions like:

View Telemetry: Displays the real-time telemetry data of an IoT device.

Disconnect: Disconnects an IoT device from the server.

Delete: Deletes an IoT device.

"Mobile Apps" Tab
Displays the list of connected and disconnected mobile applications. Possible actions:

View Details: Displays information about the mobile application.

Disconnect: Disconnects a mobile application from the server.

Delete: Deletes a mobile application from the system.

"Logs" Tab
Displays the HTTP logs generated by the server. It is possible to filter logs by severity level (info, warning, error). The logs are color-coded to ease reading.

Section Details
Connected Devices: List of currently connected IoT devices. Each device can be viewed with its telemetry data.

Disconnected Devices: List of registered but disconnected IoT devices, with options to delete them.

Connected Applications: List of currently connected mobile applications.

Disconnected Applications: List of registered but disconnected mobile applications.

Data Flow
The system operates in real-time, constantly synchronizing data between clients (IoT devices and mobile applications) and the server.

IoT Devices (Things)
IoT devices are connected via WebSocket, and their state (connected or not) is managed by the ThingsManager. Information about devices is sent to connected clients in real-time.

Mobile Applications
Mobile applications also connect via WebSocket. The AppMobileManager manages connections and interactions with mobile applications.

HTTP Logs
The server generates HTTP logs for every received request. These logs are streamed in real-time to the application via a logStream and can be filtered based on their severity level.

HTTP Request Management
HTTP requests are handled by an HTTP server based on the shelf library in Dart. Requests are processed according to their method (GET, POST), and each action is logged for detailed tracking.

Example of a Request to Register a Mobile Application
Request:

http
Copier
Modifier
POST /api/v1/register
Content-Type: application/json

{
  "id": "12345",
  "name": "My Mobile App"
}
Response:

json
Copier
Modifier
{
  "message": "App registered successfully",
  "appKey": "abcde12345"
}
SocketServerManager
The SocketServerManager is an essential part of the server architecture, responsible for managing real-time communication via WebSocket between the server and IoT clients (devices) as well as mobile applications. It offers centralized management of connections, authentication, telemetry data transmission, and disconnections.

Architecture and Features
WebSocket Servers
The manager instantiates two separate WebSocket servers:

Server Type	Port	Description
Server for Mobile Applications	server_constants.socketMobileAppServerPort	Manages connections for mobile applications.
Server for IoT Devices	server_constants.socketThingsServerPort	Manages connections for IoT devices (Things).
Connection and Authentication
Authentication process for any client (mobile or IoT):

Initiation Step:

The client connects to the appropriate WebSocket server.

Sending Credentials:

The client must provide an id and a key to authenticate.

Validation:

If the credentials are valid, the client is added to the list of connected clients.

If authentication fails:

An error response is sent to the client.

The connection is closed immediately.

Telemetry Data Flow
The server handles the telemetry data sent by IoT devices:

Reception:

Each received message is parsed and stored in an internal list.

Broadcasting:

The data is broadcasted in real-time via a StreamController for interface/service updates.

Telemetry Data Format:

json
Copier
Modifier
{
  "type": "telemetry",
  "data": {
    "thingId": "sensor_1234",
    "type": "temperature",
    "value": "25.6",
    "timestamp": "2023-10-01T12:34:56Z"
  }
}
##Conclusion
This project enables the real-time management of IoT devices and mobile applications with an intuitive and interactive graphical interface. HTTP logs and real-time updates ensure a smooth user experience. Thanks to a robust and flexible server architecture, the project can easily be expanded to include new types of IoT devices or additional features.
